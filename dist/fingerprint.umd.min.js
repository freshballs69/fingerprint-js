!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self).Fingerprint={})}(this,function(e){"use strict";function n(e,n=0){let t=n>>>0;for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);r=Math.imul(r,3432918353),r=r<<15|r>>>17,r=Math.imul(r,461845907),t^=r,t=t<<13|t>>>19,t=Math.imul(t,5)+3864292196}return t^=e.length,t^=t>>>16,t=Math.imul(t,2246822507),t^=t>>>13,t=Math.imul(t,3266489909),t^=t>>>16,t>>>0}function t(){const e=[],n=Object.getOwnPropertyNames(window),t={chrome:["chrome"],firefox:["InstallTrigger"],safari:["safari"],edge:["msWriteProfilerMark"],opera:["opr","opera"]};for(const[r,o]of Object.entries(t))for(const t of o)if(n.includes(t)||t in window){e.push(r);break}return e}function r(){try{document.cookie="fp_test=1";const e=-1!==document.cookie.indexOf("fp_test=");return document.cookie="fp_test=1; expires=Thu, 01 Jan 1970 00:00:00 UTC",e}catch(e){return!1}}function o(){const e=[];!0===navigator.webdriver&&e.push("navigator.webdriver");const n=Object.keys(document);for(const t of n)if(t.startsWith("$cdc_")||t.startsWith("$wdc_")){e.push("chromedriver");break}const t=window;(t.callPhantom||t._phantom||t.phantom)&&e.push("phantomjs"),t.__nightmare&&e.push("nightmare"),(t.domAutomation||t.domAutomationController)&&e.push("domAutomation"),(t._selenium||t.__webdriver_script_fn||t.__driver_evaluate||t.__webdriver_evaluate||t.__selenium_evaluate||t.__fxdriver_evaluate||t.__driver_unwrapped||t.__webdriver_unwrapped||t.__selenium_unwrapped||t.__fxdriver_unwrapped||t._Selenium_IDE_Recorder||t._WEBDRIVER_ELEM_CACHE)&&e.push("selenium"),t.__$webdriverAsyncExecutor&&e.push("webdriverAsyncExecutor"),(t.webdriver||t.__webdriverFunc)&&e.push("webdriverWindow"),t.Cypress&&e.push("cypress");return navigator.userAgent.toLowerCase().includes("headless")&&e.push("headlessUA"),{detected:e.length>0,signals:e}}function a(){try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){return""}}function i(){try{return!!window.sessionStorage}catch(e){return!1}}function s(){try{return!!window.localStorage}catch(e){return!1}}function c(){try{return!!window.indexedDB}catch(e){return!1}}function l(){try{const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)return"";e.width=200,e.height=50,t.textBaseline="alphabetic",t.font="14px Arial",t.fillStyle="#f60",t.fillRect(125,1,62,20),t.fillStyle="#069",t.fillText("Fingerprint",2,15),t.fillStyle="rgba(102, 204, 0, 0.7)",t.fillText("Canvas Test",4,45),t.globalCompositeOperation="multiply",t.fillStyle="rgb(255,0,255)",t.beginPath(),t.arc(50,50,50,0,2*Math.PI,!0),t.closePath(),t.fill(),t.fillStyle="rgb(0,255,255)",t.beginPath(),t.arc(100,50,50,0,2*Math.PI,!0),t.closePath(),t.fill();return n(e.toDataURL()).toString(16)}catch(e){return""}}const u=["Arial","Arial Black","Arial Narrow","Bookman Old Style","Century","Century Gothic","Comic Sans MS","Courier","Courier New","Georgia","Helvetica","Impact","Lucida Console","Lucida Sans Unicode","Microsoft Sans Serif","Palatino Linotype","Tahoma","Times","Times New Roman","Trebuchet MS","Verdana","Wingdings"],d=["monospace","sans-serif","serif"];function f(){const e=[],n=document.createElement("canvas").getContext("2d");if(!n)return e;const t=e=>(n.font=`72px ${e}`,n.measureText("mmmmmmmmmmlli").width),r={};for(const e of d)r[e]=t(e);for(const n of u){let o=!1;for(const e of d){if(t(`"${n}", ${e}`)!==r[e]){o=!0;break}}o&&e.push(n)}return e}function h(){const e=[];if(!navigator.plugins)return e;for(let n=0;n<navigator.plugins.length;n++){const t=navigator.plugins[n];t&&e.push(t.name)}return e.sort()}function g(){return"undefined"!=typeof window&&window.__stunServerUrl?window.__stunServerUrl:""}function p(e){"undefined"!=typeof window&&(window.__stunServerUrl=e)}function m(){var e,n;let t="http://127.0.0.1:5001",r=null;if("undefined"!=typeof process&&((null===(e=process.env)||void 0===e?void 0:e.FINGERPRINT_BASE_URL)&&(t=process.env.FINGERPRINT_BASE_URL),(null===(n=process.env)||void 0===n?void 0:n.TRACK_API)&&(r=process.env.TRACK_API)),"undefined"!=typeof window){const e=window;e.FINGERPRINT_BASE_URL&&(t=e.FINGERPRINT_BASE_URL),e.TRACK_API&&(r=e.TRACK_API)}return t=t.replace(/\/$/,""),{baseUrl:t,trackUrl:r}}async function w(e,n){const{url:t,method:r="POST",headers:o={}}=n;return await fetch(t,{method:r,headers:{"Content-Type":"application/json",...o},body:JSON.stringify(e)})}async function v(e={},u){const d=new Set(e.excludeComponents||[]),p=d.has("webglVendor")&&d.has("webglRenderer")&&d.has("webglVersion")?{vendor:"",renderer:"",version:""}:function(){const e={vendor:"",renderer:"",version:""};try{const n=document.createElement("canvas"),t=n.getContext("webgl")||n.getContext("experimental-webgl");if(!(t&&t instanceof WebGLRenderingContext))return e;const r=t.getExtension("WEBGL_debug_renderer_info");r&&(e.vendor=t.getParameter(r.UNMASKED_VENDOR_WEBGL)||"",e.renderer=t.getParameter(r.UNMASKED_RENDERER_WEBGL)||""),e.version=t.getParameter(t.VERSION)||""}catch(e){}return e}(),m=d.has("audio")?0:await async function(){try{const e=window.AudioContext||window.webkitAudioContext;if(!e)return 0;const t=new e,r=t.createOscillator(),o=t.createAnalyser(),a=t.createGain(),i=t.createScriptProcessor(4096,1,1),s=t.destination;r.type="triangle",r.frequency.setValueAtTime(1e4,t.currentTime),a.gain.setValueAtTime(0,t.currentTime),r.connect(o),o.connect(i),i.connect(a),a.connect(s),r.start(0);const c=await new Promise(e=>{const t=new Float32Array(o.frequencyBinCount);o.getFloatFrequencyData(t),e(n(t.slice(0,50).join(",")))});return r.disconnect(),o.disconnect(),i.disconnect(),a.disconnect(),t.close(),c}catch(e){return 0}}(),w=d.has("webrtcAvailable")&&d.has("webrtcLocalIPs")?{available:!1,localIPs:[]}:await async function(){const e={available:!1,localIPs:[]};if("undefined"==typeof RTCPeerConnection)return e;e.available=!0;const n=g(),t=n?[{urls:n}]:[];"undefined"!=typeof console&&(console.log("[Fingerprint] WebRTC STUN URL:",n),console.log("[Fingerprint] ICE servers:",JSON.stringify(t)));try{const n=new RTCPeerConnection({iceServers:t}),r=new Set;return new Promise(t=>{const o=setTimeout(()=>{n.close(),e.localIPs=Array.from(r),t(e)},1e3);n.onicecandidate=a=>{if(!a.candidate)return"undefined"!=typeof console&&console.log("[Fingerprint] ICE gathering complete, IPs found:",Array.from(r)),clearTimeout(o),n.close(),e.localIPs=Array.from(r),void t(e);"undefined"!=typeof console&&console.log("[Fingerprint] ICE candidate:",a.candidate.candidate);const i=a.candidate.candidate,s=i.match(/(\d{1,3}\.){3}\d{1,3}/);s&&r.add(s[0]);const c=i.match(/([a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/i);c&&r.add(c[0])},n.createDataChannel(""),n.createOffer().then(e=>n.setLocalDescription(e)).catch(()=>{clearTimeout(o),n.close(),t(e)})})}catch(n){return e}}();return{userAgent:d.has("userAgent")?"":navigator.userAgent,language:d.has("language")?"":navigator.language,languages:d.has("languages")?[]:Array.from(navigator.languages||[navigator.language]),colorDepth:d.has("colorDepth")?0:screen.colorDepth,screenResolution:d.has("screenResolution")?[0,0]:[screen.width,screen.height],availableScreenResolution:d.has("availableScreenResolution")?[0,0]:[screen.availWidth,screen.availHeight],timezone:d.has("timezone")?"":a(),timezoneOffset:d.has("timezoneOffset")?0:(new Date).getTimezoneOffset(),sessionStorage:!d.has("sessionStorage")&&i(),localStorage:!d.has("localStorage")&&s(),indexedDb:!d.has("indexedDb")&&c(),cookiesEnabled:!d.has("cookiesEnabled")&&r(),platform:d.has("platform")?"":navigator.platform,hardwareConcurrency:d.has("hardwareConcurrency")?0:navigator.hardwareConcurrency||0,deviceMemory:d.has("deviceMemory")?null:navigator.deviceMemory||null,maxTouchPoints:d.has("maxTouchPoints")?0:navigator.maxTouchPoints||0,vendor:d.has("vendor")?"":navigator.vendor||"",vendorFlavors:d.has("vendorFlavors")?[]:t(),canvas:d.has("canvas")?"":l(),webglVendor:d.has("webglVendor")?"":p.vendor,webglRenderer:d.has("webglRenderer")?"":p.renderer,webglVersion:d.has("webglVersion")?"":p.version,fonts:d.has("fonts")?[]:f(),audio:d.has("audio")?0:m,plugins:d.has("plugins")?[]:h(),doNotTrack:d.has("doNotTrack")?null:navigator.doNotTrack||null,webrtcAvailable:!d.has("webrtcAvailable")&&w.available,webrtcLocalIPs:d.has("webrtcLocalIPs")?[]:w.localIPs,webdriver:d.has("webdriver")?{detected:!1,signals:[]}:o()}}async function _(e={},n){const t=await v(e),r=JSON.stringify(t);return{hash:await async function(e){const n=(new TextEncoder).encode(e),t=await crypto.subtle.digest("SHA-256",n);return Array.from(new Uint8Array(t)).map(e=>e.toString(16).padStart(2,"0")).join("")}(r),components:t,timestamp:Date.now()}}function y(e,n){if(!e)return;const t=function(e,n){const t=new URL(e);return t.searchParams.has("req_id")||t.searchParams.set("req_id",n),t.toString()}(e,n);fetch(t).catch(()=>{})}async function b(e){const n=function(e){const n=m(),t=new URL(`${n.baseUrl}/api/v2/init`);return e&&t.searchParams.set("public_key",e),t.toString()}(e),t=await fetch(n);if(!t.ok)throw new Error(`Init failed: ${t.status}`);const r=await t.json();return{reqId:"string"==typeof r.req_id?r.req_id:null,trackUrl:"string"==typeof r.track_url?r.track_url:null,stun:"string"==typeof r.stun?r.stun:null}}async function S(e={}){const n=await b(e.public_key);if(!n.reqId)return null;n.stun&&p(n.stun);const t=await new Promise((t,r)=>{"complete"===document.readyState||"interactive"===document.readyState?_(e,n.reqId).then(t).catch(r):document.addEventListener("DOMContentLoaded",()=>{_(e,n.reqId).then(t).catch(r)})}),r=m();let o=n.reqId;const a=n.trackUrl||r.trackUrl,i=`${m().baseUrl}/api/v2/fingerprint`;try{t.req_id=o;const e=await w(t,{url:i});if((e.headers.get("content-type")||"").includes("application/json")){const n=await e.json();n&&"string"==typeof n.req_id&&(o=n.req_id)}}catch(e){}return y(a,o),o}const A=Object.assign(e=>function(e={}){return{getFingerprint:(n,t)=>_({...e,...n}),collect:n=>S({...e,...n}),sendFingerprint:w,setStunServerHost:p}}(e),{getFingerprint:_,collect:S,sendFingerprint:w,setStunServerHost:p});"undefined"!=typeof window&&(window.Fingerprint=A),e.collect=S,e.default=A,e.getFingerprint=_,e.getStunServerHost=g,e.sendFingerprint=w,e.setStunServerHost=p,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=fingerprint.umd.min.js.map
